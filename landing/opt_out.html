

<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>ServiceMedia</title>

  <!-- Bootstrap core CSS -->
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom fonts for this template -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="vendor/simple-line-icons/css/simple-line-icons.css">
  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Catamaran:100,200,300,400,500,600,700,800,900" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Muli" rel="stylesheet">
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <!-- Plugin CSS -->
  <!-- <link rel="stylesheet" href="device-mockups/device-mockups.min.css"> -->

  <!-- Custom styles for this template -->
  <link href="css/new-age.css" rel="stylesheet">
  <!-- <script data-ad-client="ca-pub-5450402133525063" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> -->
</head>

<body id="page-top">

  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
    <div class="container">
      <a class="navbar-brand js-scroll-trigger" href="../index.html#page-top">ServiceMedia</a>
      <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
        Menu
        <i class="fas fa-bars"></i>
      </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ml-auto">
          <!-- <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#download">Download</a>
          </li>-->
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="../index.html#contact">Contact</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="../index.html#scenes">Scenes</a>
          </li>
          <!-- <li class="nav-item">
            <a class="pull-right" style="margin-top:14px; margin-right:14px; width: 64px; height: 53px;" href="https://github.com/polytropoi/ServiceMedia/">
              <img src="https://servicemedia.s3.amazonaws.com/assets/pics/Octocat.png"></a>
          </li> -->
          <li class="nav-item">
            <!-- <iframe src="https://github.com/sponsors/polytropoi/button" title="Sponsor polytropoi" height="35" width="107" style="border: 0;"></iframe> -->
            <!-- <a class="nav-link js-scroll-trigger" href="#scenes">Scenes</a> -->
          </li> 
          <li class="nav-item">
            <a class="pull-right" href="https://www.facebook.com/ServiceMedia-405792179602091/">
              <img src="http://servicemedia.s3.amazonaws.com/assets/pics/fb.png"></a>
          </li> 
          

        </ul>
      </div>
    </div>
  </nav>

  <header class="masthead">
    <div class="container h-100">
      <div class="row h-100">
        <div class="col-lg-12 my-auto">
          <p id="main"></p>
          <div class="header-content mx-auto">
            <!-- <h1 class="mb-5">Notification Preferences</h1><br> -->
            
            <!-- <a href="https://play.google.com/store/apps/details?id=net.servicemedia.servmed" class="btn btn-outline btn-xl js-scroll-trigger">Get the latest Android version</a><br><br> -->

            <!-- <a href="https://apps.apple.com/us/app/servicemedia/id1441654277" class="btn btn-outline btn-xl js-scroll-trigger">Get the latest iOS version</a><br><br> -->
            <!-- <a href="#download" class="btn btn-outline btn-xl js-scroll-trigger">Get the iOS App</a><br><br> -->
            <!-- <a href="https://servicemedia.s3.amazonaws.com/builds/sm2020Win20201028.zip" class="btn btn-outline btn-xl js-scroll-trigger">Get the latest Windows 64 version</a><br><br> -->
          <!-- </div>
          <button class="btn btn-primary">Block messages from the ServiceMedia Platform</button>
          <br>          <br>          -->
          
        </div>
        <div class="col-lg-5 my-auto">

        </div>
      </div>
    </div>
  </header>


  <footer>
    <div class="container">
      <p>&copy; ServiceMedia 2020. All Rights Reserved.</p>
      <ul class="list-inline">
        <li class="list-inline-item">
          <a href="#">Privacy</a>
        </li>
        <li class="list-inline-item">
          <a href="#">Terms</a>
        </li>
        <li class="list-inline-item">
          <a href="#">FAQ</a>
        </li>
      </ul>
    </div>
  </footer>
<script>
  let main = document.getElementById('main');
        function getParameterByName(name, url) {
            if (!url) {
                url = window.location.href;
            }
            name = name.replace(/[\[\]]/g, "\\$&");
            var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, " "));
        }
        const params = getParameterByName('iv');
        console.log("params : " + params);
        let now = Date.now();
        let eventCountdownEl = "";
        let eventDurationEl = "";
        let userInfo = {};
        // let data = JSON.parse(atob(params));
        // console.log(data);  
        axios.get('/optout_check/' + params)    
            .then(function (response) {
                //need email/name/ and scene/sender 
     
                    // let uname = response.data.to.toString().split('@')[0];

            userInfo = response.data;
                        console.log(JSON.stringify(response));
                        main.innerHTML = "Hi <strong>" + userInfo.sentToEmail[0] + " </strong> - to stop messages from the ServiceMedia platform, <button onclick=\x22optOut()\x22 class=\x22btn btn-primary\x22 id=\x22optOutButton\x22>Click here</button>";
                       

                    
                
            }) //end of main fetch
            .catch(function (error) {
                console.log(error);
                main.innerHTML = "error!";
            });

            // let optOutButton = document.getElementById("optOutButton");
            // optOutButton.addEventListener("click", function() {
            //   alert("Hello World!"); 
            // });
            function optOut () {
              console.log(userInfo.sentToEmail[0]);
              var hostname = "";
              var posting = $.ajax({
              url: hostname + "/optout",
              type: 'POST',
                contentType: "application/json; charset=utf-8",
              dataType: "json",
              data: JSON.stringify({
                    sentToEmail: userInfo.sentToEmail[0].trim(),
                    
                    // param2: $('#textbox2').val()
                  }),
                success: function( data, textStatus, xhr ){
                    console.log(data);
                    main.innerHTML = "Thanks, no further messages will be sent to "+userInfo.sentToEmail[0].trim()+". To opt back in, contact admin@servicemedia.net";
                    
                },
                error: function( xhr, textStatus, errorThrown ){
                  main.innerHTML = "Whoops, something went wrong!";
                  }
                });
            }

</script>
  <!-- Bootstrap core JavaScript -->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- Plugin JavaScript -->
  <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

  <!-- Custom scripts for this template -->
  <script src="js/new-age.js"></script>

</body>

</html>
